---
title: "Lab ACP"
author: 
  - "Edwin Sanchez"
  - "Stephanie Tamayo"
  - "Andres Felipe Torres"
  - "Fredy Urrea"
  - "Sergio Velasquez"
  - "Manuel Espitia"
date: "2025-05-18"
output: 
  beamer_presentation:
    theme: "Madrid"
    colortheme: "spruce"
    fonttheme: "structurebold"
    latex_engine: xelatex
    slide_level: 2
    fig_width: 6.5
    fig_height: 4
    dev: "cairo_pdf"
    keep_tex: true
---

```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("FactoMineR")
library("dplyr")
library("kableExtra")
library(readxl)
library(FactoMineR)
library(factoextra)
library(kableExtra)
```


## Introduccion

### Carga de los datos
\scriptsize
\vspace{0em}
Organización de los datos y renombrar variables

```{r cars, results='hide',message = FALSE, warning=FALSE}

CIUDADES<-readxl::read_excel("ciudades original-filtrado-con etiquetas (1).xlsx",
                               sheet = 1)
RHINT<-CIUDADES[,c("CIUDADES","RH_1","RH_2","RH_5","RH_6","RH_7",
                     "RH_8","RH_9","RH_10","RH_11","RH_12","RH_13",
                     "RH_14","RH_15","RH_16","INT_66","INT_67",
                     "INT_68","INT_69","INT_70")]
colnames(RHINT)[2:20] <- c("PC", "TCP","AA","CBPS","CBES","RAP","CC",
                           "CPT","CS","MI","DCFS","VI","H","S","BCPIB",
                           "CI","TOE","DP","DM")

```

---


## Punto 1

### Estandarización de datos

```{r cars2}

RHINTce <- scale(RHINT[,2:20], scale = TRUE, center = TRUE)
colnames(RHINTce) <- colnames(RHINT)[2:20]
rownames(RHINTce) <- RHINT$CIUDADES
```

Hacemos el PCA de nuestros datos con todas las variables que nos toca en
nuestro grupo 6 (RH+INT) y observamos nuestros datos con el circulo
unitario con las dos componentes que capturan mayor varianza de nuestros
datos.

---

\vspace{5em}
```{r pressure2, echo=FALSE}
PCAtodas<-PCA(RHINT[,2:20],scale.unit = T, ncp=7)

```

---

\vspace{-22em}
```{r pressure23, echo=FALSE}
PCAtodas<-PCA(RHINT[,2:20],scale.unit = T, ncp=7)

```

---

#### Selección de Componentes Principales:

Aplicamos el criterio de Kaiser (autovalor > 1), reteniendo solo los componentes más informativos.

- 6 componentes cumplieron el criterio, explicando ~80% de la varianza total.

- El componente 7 (6.2% adicional) podría omitirse para simplificar el modelo sin perder información crítica.

Varianza explicada:

- Componente 1: 23.0% (autovalor: 4.36)

- Componente 2: 19.4% (autovalor: 3.69)

- Componente 3: 12.4% (autovalor: 2.36)

Total acumulado (3 primeros): 54.8%



---

### Tabla de varianza explicada con índice personalizado

```{r varianza_table, echo=FALSE}
# Tabla de varianza explicada con índice personalizado
tabla_varianza <- PCAtodas$eig[1:7, ]

# Personaliza este título/índice
indice_tabla <- "Tabla 1. Varianza explicada por los componentes principales"

kable(tabla_varianza,
      caption = indice_tabla,
      digits = 2,
      col.names = c("Autovalor", "Varianza (%)", "Varianza Acumulada (%)"),
      format = "latex",
      booktabs = TRUE) %>%
  kable_styling(
    latex_options = c("scale_down", "hold_position", "striped"),
    font_size = 8,
    position = "center"
  ) %>%
  row_spec(0, bold = TRUE) %>%
  footnote(
    general = paste("Nota: Se muestran los primeros", nrow(tabla_varianza), 
                    "componentes que explican el", 
                    round(sum(tabla_varianza[,2]), 1), 
                    "% de la varianza total"),
    number = c("Criterio de selección: Autovalor > 1 (Kaiser)",
               paste("Fecha de análisis:", format(Sys.Date(), "%d/%m/%Y")))
  )

```

---

\scriptsize
##### Componente 1 (22.96% varianza):

- Variables: Población (0.54), Tasa de Ocupación (0.45), Analfabetismo (0.49).

- Interpretación: Eje de desarrollo urbano y acceso a servicios básicos.

##### Componente 2 (19.40% varianza):

- Variables: Cobertura educativa (0.98), Internacionalización (0.97).

- Interpretación: Capital humano y apertura económica.

##### Componente 3 (12.43% varianza):

- Variables: Calidad educativa (0.97), Diversificación de mercados (0.94).

- Interpretación: Calidad educativa y diversificación productiva.

##### Hallazgos Principales:

- Los 3 primeros componentes resumen el 54.78% de la varianza total.

- Variables educativas y económicas forman dimensiones independientes.

- Correlaciones >0.7 en componentes 2 y 3 permiten simplificar el modelo sin pérdida crítica de información.

---

### Tabla de correlaciones variables componentes

```{r corr_table, echo=FALSE}
# Tabla de correlaciones variables-componentes (solo para PDF/Beamer)
kable(PCAtodas$var$cor,
      caption = "Matriz de correlaciones entre variables y componentes principales",
      col.names = paste0("Comp.", 1:ncol(PCAtodas$var$cor)),
      digits = 2,
      format = "latex",
      booktabs = TRUE) %>%
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  row_spec(0, bold = TRUE) %>%
  footnote(general = "Valores representan coeficientes de correlación entre -1 y 1. Correlaciones > |0.5| se consideran significativas.")
```


---

##### Dimensión 1 (X) - Eje principal
- Variables clave: MP (0.94), PC (0.94)
- Interpretación: Eje "tamaño económico-demográfico" donde ciudades más pobladas concentran mayor actividad económica.

##### Dimensión 2 (Y) - Eje secundario
-  Variables débiles: DM (0.22), TCP (0.12)
- Interpretación: "Dinamismo básico" menos estructurado, vinculado a crecimiento incremental.

##### Hallazgo crítico:
- El desarrollo económico (X) no garantiza mejoras en indicadores sociales (Y), requiriendo políticas diferenciadas.

---

```{r grafico_var_dim12, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.width=10, fig.height=6, fig.cap="Gráfico de variables (Dim.1 vs Dim.2) - Análisis PCA"}
# Gráfico de variables para Dim.1 vs Dim.2 (optimizado)
fviz_pca_var(PCAtodas, 
             axes = c(1, 2),                # Dimensiones 1 y 2 (ejes principales)
             col.var = "contrib",           # Color por contribución a las dimensiones
             gradient.cols = c("#2E9FDF", "#E7B800", "#D55E00"),  # Gradiente azul-amarillo-rojo
             repel = TRUE,                  # Textos inteligentes sin solapamiento
             alpha.var = "contrib",         # Transparencia según contribución
             title = "Mapa de Variables - PCA (Dimensión 1 vs Dimensión 2)") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, face = "bold", size = 14),
    legend.position = "right",
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 12)
  ) 
```

---

\scriptsize
##### Dimensión 1 (Estructural):
- Variables clave: Población, Crecimiento poblacional, Homicidios, Balanza comercial/PIB
- Interpretación: Eje económico-demográfico dominante (mayor varianza explicada)

##### Dimensión 3 (Social/Seguridad):
- Variables críticas: Violencia intrafamiliar, Secuestros, Cobertura en salud, Mortalidad infantil
- Interpretación: Problemáticas sociales con dinámica independiente del desarrollo económico

##### Hallazgos clave:
- Las variables educativas (ej. Cobertura educación superior) muestran influencia compartida
- Contraste fundamental: Desarrollo económico (Dim.1) ≠ Mejora en seguridad/salud (Dim.3)
- Implica necesidad de políticas diferenciadas para cada dimensión

---


```{r graficos_dim13_variables, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center', fig.width=10, fig.height=6}
# Cargar librerías (si no están cargadas previamente)
library(FactoMineR)
library(factoextra)
library(ggplot2)

# Gráfico de VARIABLES para Dim.1 vs Dim.3 (solo este gráfico)
fviz_pca_var(PCAtodas, 
             axes = c(1, 3),       # Dimensiones 1 y 3
             col.var = "contrib",   # Color por contribución
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE,          # Evita solapamiento de etiquetas
             title = "Variables - PCA (Dimensión 1 vs Dimensión 3)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))  # Título centrado y en negrita
```

---

\scriptsize
##### Dimensión 2 (Educación/Comercio):
- Variables clave:

  - Cobertura educativa básica

  - Calidad escolar

  - Diversificación productiva

  - Orientación exportadora
  - Interpretación: Eje de capital humano e integración económica

##### Dimensión 3 (Seguridad/Salud):
- Variables críticas:

  - Delitos sexuales

  - Mortalidad infantil

  - Cobertura sanitaria
  - Interpretación: Problemáticas sociales independientes del desarrollo educativo-comercial

##### Hallazgo clave:
- Las dimensiones revelan que avances educativos/económicos no garantizan mejoras en seguridad/salud, exigiendo intervenciones específicas para cada ámbito.

---

```{r PCA-Dim1-vs-Dim3, echo=FALSE, message=FALSE, warning=FALSE}
# Cargar paquetes necesarios
library(factoextra)
library(gridExtra)

# Gráfico de variables para Dim.1 vs Dim.3
grafico_var_dim13 <- fviz_pca_var(PCAtodas, 
                                 axes = c(1, 3),  # Selecciona dimensiones 1 y 3
                                 col.var = "contrib", 
                                 gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                                 repel = TRUE,
                                 title = "Variables - Dim.1 vs Dim.3") +
  theme_minimal()

# Gráfico de individuos para Dim.1 vs Dim.3
grafico_ind_dim13 <- fviz_pca_ind(PCAtodas, 
                                 axes = c(1, 3),  # Selecciona dimensiones 1 y 3
                                 col.ind = "cos2",
                                 gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                                 repel = TRUE,
                                 title = "Individuos - Dim.1 vs Dim.3") +
  theme_minimal()

# Combinar ambos gráficos
grid.arrange(grafico_var_dim13, grafico_ind_dim13, nrow = 1)
```

---

\scriptsize
##### Dimensión 2 (Educación-Comercio):

- Separa claramente:

  - Variables educativas (Capacitación laboral)

  - Variables comerciales (Dinámica exportadora)

- Muestra correlación entre:

  - Anafabetismo y Cobertura educativa superior

##### Dimensión 3 (Problemáticas Sociales):

- Aísla variables independientes:

  - Violencia intrafamiliar (aparece como outlier)

  - Otras problemáticas sociales

##### Conclusión:

- Dim.2 complementa el análisis económico (Dim.1) con aspectos de capital humano

- Dim.3 revela desafíos sociales que requieren abordaje específico

#### Las dimensiones muestran que:

  - Avances educativos ≠ Mejoras en seguridad

  - Desarrollo económico ≠ Solución automática a problemáticas sociales

---

```{r biplot}
fviz_pca_biplot(PCAtodas)
```

---

\scriptsize
##### Varianza explicada:

- Dim.1: 23% (desarrollo económico)

- Dim.2: 19.4% (capital humano)

- Total: 42.4% de variabilidad

##### Hallazgos clave:

- Perfiles urbanos diferenciados

- Bogotá, Medellín, Cali:
  - Alto desempeño en:

    - Población (PC)

    - Educación superior (CBES)

    - Apertura comercial (DP, TOE)

- Riohacha, Sincelejo:
  - Desafíos en:

    - Analfabetismo (AA)

    - Mortalidad infantil (MI)

    - Crecimiento poblacional (TCP)

---    

##### Posiciones intermedias

- Cartago: Destaca en internacionalización (CI)

- Neiva/Tunja: Perfiles socioeconómicos equilibrados

- Agrupamientos reveladores

  - Ciudades principales (3, 5, 10) comparten patrones de desarrollo

  - Ciudades periféricas (15, 17, 21) muestran trayectorias divergentes

##### Conclusión:
- El biplot evidencia:
  - Desigualdades regionales marcadas
  - Relaciones clave entre desarrollo económico y social
  - Oportunidades para políticas públicas diferenciadas


---

\scriptsize
```{r biplotcol}
fviz_pca_biplot(PCAtodas, 
                axes = c(1, 3),  # Dim.1 (X) vs Dim.3 (Y)
                col.var = "#FF7F00",  # Color naranja para variables
                ggtheme = theme_bw(),  # Fondo blanco/gris
                title = "Biplot PCA: Dim.1 vs Dim.3")
```

---

\scriptsize
##### Varianza explicada:

  - Dim.1: 23% (desarrollo urbano-educativo)

  - Dim.3: 12.4% (seguridad y empleo)

  - Total: 35.4%

##### Patrones clave:

- Eje de desarrollo (Derecha - Dim.1)


- Diversificación de mercados (DM)

- Población (PC)

- Educación superior (CBES)

##### Ciudades destacadas: 
- Bogotá (3), Cali (5), Medellín (7)

---

\scriptsize
##### Variables críticas:

- Analfabetismo (AA)

- Delitos sexuales (DCFS)

- Ciudades afectadas: Riohacha (16), Sincelejo (22)

- Dimensión 3 (Inferior)

- Variables diferenciadoras:

- Capacitación laboral (CPT)

- Secuestros (S)

- Casos particulares: San Andrés (17), Cartago (6)

##### Conclusiones:

- Confirma el liderazgo de las principales ciudades en desarrollo
- Revela problemas estructurales en educación y seguridad
- Identifica patrones únicos en ciudades intermedias

---

\scriptsize
```{r setup 1}
fviz_pca_biplot(PCAtodas, 
                axes = c(2, 3),  # Dim.2 (X) vs Dim.3 (Y)
                col.var = "#FF7F00",  # Color naranja para variables
                ggtheme = theme_bw(),  # Fondo blanco/gris
                title = "Biplot PCA: Dim.2 vs Dim.3")
```

---

\scriptsize
##### Cuadrante superior derecho
 
- Variables críticas:
  - Analfabetismo (AA)
  - Mortalidad infantil (MI)

- Ciudades asociadas: Riohacha (16), Bogotá (3)

- Interpretación: Nucleo de desafíos sociales persistentes

##### Cuadrante inferior derecho

- Variables económicas:
  - Apertura comercial (TOE, DP)

  - Ciudad destacada: Cartago (6)

- Interpretación: Polos de desarrollo económico

---

\scriptsize
##### Lado izquierdo

- Variables mixtas:
  - Calidad educativa (CC)
  - Violencia intrafamiliar (VI)

- Ciudades: Tunja (20), Pasto (13)

- Interpretación: Perfiles socioeducativos contrastantes

##### Hallazgos clave:
  - Bogotá muestra doble condición: desarrollo con rezagos sociales
  - Cartago emerge como caso de éxito en apertura económica
  - San Andrés (17) y Pereira (14) presentan patrones únicos en seguridad y empleo


---

## Punto 2
Utilizar la función PCA del paquete FactoMiner para realizar un ACO con todas las varibales especificas del grupo utilizando cmo ilustrativas las variables de Recursos Humanos.


### Preparación de datos

Seleccionamos las variables activas (internacionalización) y las variables ilustrativas (recursos humanos).

\vspace{-1em}
\scriptsize
```{r}
base_acp <- RHINT[, c("BCPIB", "CI", "TOE", "DP", "DM", 
                      "PC", "TCP", "AA", "CBPS", "CBES", "RAP", "CC", 
                      "CPT", "CS", "MI", "DCFS", "VI", "H", "S")]
```

### Análisis de Componentes Principales (ACP)
\vspace{-1em}
\scriptsize
```{r}
res.pca <- PCA(base_acp, scale.unit = TRUE, quanti.sup = 6:19, graph = FALSE)
```

---

### Resultados

#### a) Valores propios
\vspace{0em}
\scriptsize
```{r}
eig.val <- round(res.pca$eig, 3)
kable(eig.val, format = "latex", booktabs = TRUE,
      caption = "Valores propios y varianza explicada") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

---

\scriptsize
##### Dimensión 1 - Apertura Internacional (62.2%)
- Eje de competitividad global

- Alta participación en redes globales (Coef. Internacionalización)

- Economía orientada a exportaciones

- Diversificación productiva (resistencia a crisis)

- Superávit comercial pero bajo dinamismo exportador

- Posible dependencia de pocos sectores

##### Dimensión 2 - Equilibrio Social-Educativo (23.2%)

- Contraste entre desarrollo humano y crecimiento económico

- Superávit comercial + diversificación de mercados

- Estabilidad macroeconómica con proyección internacional

- Ciudades con alto volumen exportador pero:

- Déficits en salud/educación

- Estructura demográfica vulnerable

- Riesgo de sostenibilidad a largo plazo

---

#### b) Correlaciones de variables activas
\vspace{0em}
\scriptsize
```{r}
kable(round(res.pca$var$cor, 3), format = "latex", 
      booktabs = TRUE,
      caption = "Correlación de variables activas con los factores") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

---

##### Polo Positivo (Ciudades Globalizadas):
- Mayor población y mejor cobertura educativa (primaria a superior)
- Dinamismo económico con oportunidades educativas
- Contraste: Presentan mayores tasas de mortalidad infantil y homicidios (complejidad urbana)

##### Polo Negativo (Ciudades menos Internacionalizadas):
- Menos violencia (intrafamiliar, secuestros, delitos sexuales)
- Crecimiento poblacional más acelerado
- Rezagos educativos (analfabetismo)

##### Hallazgo Clave:
Las ciudades con mayor apertura global muestran:
- Mejor educación y seguridad ciudadana
- Pero enfrentan desafíos en salud pública y violencia
- Las menos globalizadas tienen crecimiento poblacional sin desarrollo educativo equivalente

---

#### c) Correlaciones de variables ilustrativas
\vspace{-1em}
\scriptsize
```{r}
kable(round(res.pca$quanti.sup$cor, 3), format = "latex", 
      booktabs = TRUE,
      caption = "Correlación de variables ilustrativas con los factores") %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

---

\scriptsize
##### Dimensión 1 (62,2 % de la varianza)
- Relaciona apertura internacional con mejores condiciones sociales.

- Positivas: ciudades grandes con alta cobertura educativa (CBPS, CBES), pero también con mayores tasas de mortalidad infantil y homicidios.

- Negativas: menor violencia intrafamiliar, secuestros y delitos sexuales; menor analfabetismo y crecimiento poblacional en ciudades más internacionalizadas.

##### Dimensión 2 (23,2 % de la varianza)
- Distingue un polo educativo frente a contextos con presión demográfica.

- Positivas: alta cobertura en educación superior (CBES), calidad educativa (CC), mayor población, mejor cobertura en salud.

- Negativas: mayor analfabetismo, crecimiento poblacional y mortalidad infantil en contextos con menor desarrollo educativo.

---

\scriptsize
### Visualizaciones
#### a) Mapa de variables


```{r, out.width='100%', warning=FALSE, message=FALSE, echo=FALSE}
fviz_pca_var(res.pca, col.var = "cos2", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE, title = "Variables activas e ilustrativas")
```

---

### b) Biplot

```{r}
fviz_pca_biplot(res.pca, repel = TRUE, 
                col.var = "#2E9FDF", col.ind = "#696969",
                title = "Biplot: ciudades y variables")
```

---

\scriptsize
##### Distribución de ciudades en el plano factorial

Las ciudades se agrupan según dos ejes: apertura internacional y desarrollo social y educativo.

- Cuadrante superior derecho: Ciudades 3, 5 y 10, con alto dinamismo exportador y buena cobertura en educación y salud.

- Cuadrante inferior derecho: Ciudad 6, muy internacionalizada pero con problemas sociales como analfabetismo y crecimiento acelerado.

- Cuadrante superior izquierdo: Ciudades 4 y 8, con superávit comercial y cobertura educativa básica, pero sin fuerte orientación exportadora.

- Cuadrante inferior izquierdo: Ciudades 11, 12 y 17, asociadas a violencia y bajo nivel de internacionalización.

---

## Punto 3.

Utilizar la funcion PCA del paquete FactoMiner para realizar un ACP de las variables de recursos humanos (RH) utilizando como ilustrativas las que le correspondieron al grupo


### Carga de archivos  y ejecucion del ACP

\vspace{-1em}
\scriptsize
```{r pressure, results='hide', warning=FALSE, message=FALSE}

# Estandrizacion y asiganacion de nombres de la filas

RHINTce <- scale(RHINT[,2:20], scale = TRUE, center = TRUE)
colnames(RHINTce) <- colnames(RHINT)[2:20]
rownames(RHINTce) <- RHINT$CIUDADES

require(FactoMineR)
#ACP sin grafica
pcaRHINTce <- PCA(RHINTce, quanti.sup = c(15:19), graph = F, ncp = 6)
#pcaRHINTce

```

---

### Valores propios y varianza explicada
\vspace{-0.5em}
\tiny 
```{r valvar, echo=FALSE, warning=FALSE, results='asis'}
# Tabla de valores propios y varianzas
vp <- round(pcaRHINTce$eig, 4)

# Crear tabla con kableExtra
require(kableExtra)
kable(vp, format = "latex", booktabs = TRUE,
      caption = "Valores propios, porcentaje de varianza y varianza acumulada", 
      label = "vprankis",
      col.names = c("Valor propio", "% Varianza", "% Acumulado")) %>%
  kable_styling(latex_options = c("scale_down", "hold_position"), font_size = 6, full_width = FALSE) %>%
  row_spec(0, bold = TRUE)  # Encabezados en negrita
```


##### Análisis de Varianza Explicada (ACP):

- 6 primeras componentes (valores propios >1) explican 85.25% de varianza
- 1ra componente: 25.51% varianza (mayor influencia)
- 2 componentes (41.5% varianza) permiten análisis bidimensional básico
- 90% varianza requiere 8 componentes (complejidad multidimensional)
- Conclusión: Reducción dimensional efectiva, pero se requieren múltiples componentes para capturar la complejidad de los datos.
   
---


### Correlaciones variable factor
\vspace{-0.5em}
\tiny
```{r correlaciones variable factor, echo=FALSE, warning=FALSE, results='asis', fig.width=2, fig.height=2, fig.pos='H', out.width='70%'}
#tabla latex correlaciones variable factor

kable(
  round(pcaRHINTce$var$cor[, 1:6], 4),  # Selección de 6 dimensiones
  "latex",
  booktabs = TRUE,
  caption = "Correlaciones variables factor primeras 6 dimensiones",
  label = "corvarfact"
) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

##### Análisis de Correlaciones Principales (6 primeras dimensiones):

- D1: Analfabetismo↑ + Educación↓
- D2: Educación↑ vs Secuestros↑
- D3: Violencia género (Delitos 0.77, VIF 0.80)
- D5-D6: Salud y violencia vinculadas

---

### Variables y objetos graficados en distintas dimensiones

---

#### Variables y ciudades en las Dimensiones 1 y 2

\vspace{0em}
\tiny
```{r gravardim12, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figura 1. Variables y ciudades en las Dimensiones 1 y 2", out.width='90%', fig.align='center'}
library(factoextra)
library(gridExtra)
library(grid)

# Crear gráficos
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables",
  labelsize = 3
)

bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos)",
  labelsize = 3
)

# Combinar los gráficos en uno solo
combined_plot <- gridExtra::arrangeGrob(bipl1, bipl2, nrow = 1)

# Dibujar el gráfico con título (fig.cap funciona ahora)
grid::grid.draw(combined_plot)
```

---

##### Análisis de Ciudades y Variables (Dimensiones 1 y 2 - 41.5% varianza total)

- Eje X (25.5%): Educación↑ vs Secuestros↑ → Bogotá/Medellín vs Cúcuta
- Eje Y (16%): Violencia↑ vs Educación↓ → Villavicencio/Santa Marta vs Armenia
- Disparidad regional: Bogotá/Medellín vs. Cúcuta/San Andrés en desarrollo y seguridad
- Relación educación-mercados: CBES y DM correlacionan en ciudades desarrolladas
- Variables suplementarias: BCPIB y DM ayudan a contextualizar los ejes principales

---

#### Variables y ciudades en las Dimensiones 1 y 3

\vspace{0em}
\tiny

```{r grafvarobjdim13, echo=FALSE, message=FALSE, warning=FALSE, results='asis',fig.cap="Figura 1.1 Variables y ciudades en las Dimensiones 1 y 3"}
# Cargar librerías
library(factoextra)
library(gridExtra)

# Gráfico de variables (dimensiones 1 y 3)
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  axes = c(1, 3),             # <<< Aquí el cambio principal
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables (Dim.1 vs Dim.3)",
  labelsize = 3
)

# Gráfico de individuos (dimensiones 3 y 4)
bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  axes = c(1, 3),             # <<< Aquí también
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos - Dim.1 vs Dim.3)",
  labelsize = 3
)


# Combinar los gráficos en uno solo
combined_plot <- gridExtra::arrangeGrob(bipl1, bipl2, nrow = 1)

# Dibujar el gráfico con título (fig.cap funciona ahora)
grid::grid.draw(combined_plot)


```

---

##### Análisis Ciudades-Variables (Dim 1 y 3 - 40.3% varianza)

- Eje X: Crecimiento (AA/TCP) vs Educación (CC/CBES)

- Eje Y: Violencia familiar (VI/DCFS) vs Seguridad (CS/S)

Ciudades con alto crecimiento muestran dos patrones:

- Con alta violencia (Villavicencio)
- Con baja violencia (Riohacha)
- Infraestructura educativa se asocia con menor violencia específica
- Variables suplementarias (DM/PC) validan vínculo entre diversificación económica y desarrollo

---

#### Variables y ciudades en las Dimensiones 3 y 4

```{r grafvarobjdim34, echo=FALSE, message=FALSE, warning=FALSE, results='asis',fig.cap="Figura 1. Variables y ciudades en las Dimensiones 3 y 4"}
# Cargar librerías
library(factoextra)
library(gridExtra)

# Gráfico de variables (dimensiones 3 y 4)
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  axes = c(3, 4),             # <<< Aquí el cambio principal
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables (Dim.3 vs Dim.4)",
  labelsize = 3
)

# Gráfico de individuos (dimensiones 3 y 4)
bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  axes = c(3, 4),             # <<< Aquí también
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos - Dim.3 vs Dim.4)",
  labelsize = 3
)


# Combinar los gráficos en uno solo
combined_plot <- gridExtra::arrangeGrob(bipl1, bipl2, nrow = 1)

# Dibujar el gráfico con título (fig.cap funciona ahora)
grid::grid.draw(combined_plot)


```

---

##### Análisis Ciudades-Variables (Dim 3 y 4 - 26.2% varianza)

- Eje Y (D3): Violencia (VI/DCFS) vs Educación básica (CBPS)

- Eje X (D4): Secuestros/Salud vs Homicidios/Capacitación

- Paradoja educativa: Alta cobertura escolar (CBPS) coexiste con violencia familiar/sexual (VI/DCFS)

Dos modelos de seguridad:

- Ciudades con violencia doméstica (Villavicencio)

- Ciudades con secuestros pero baja violencia familiar (Bogotá)

- Formación laboral crítica: Baja capacitación (CPT) vinculada a homicidios (H) en ciudades como Cúcuta


---

#### Variables y ciudades en las Dimensiones 5 y 6

```{r grafvarobjdim56, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figura 4. Variables y ciudades en las Dimensiones 5 y 6", fig.align='center'}
library(factoextra)
library(ggpubr)

# Crear gráficos
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  axes = c(5, 6),
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables (Dim.5 vs Dim.6)",
  labelsize = 3
)

bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  axes = c(5, 6),
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos - Dim.5 vs Dim.6)",
  labelsize = 3
)

# Usar ggarrange (que sí genera un objeto tipo ggplot válido para fig.cap)
combined_plot <- ggpubr::ggarrange(bipl1, bipl2, nrow = 1)

# Imprimir la figura para que fig.cap funcione
print(combined_plot)

```

---

##### Análisis Dimensiones 5 y 6 (17.5% varianza total)

- Paradoja capitalina: Bogotá combina altos índices violentos con fuerte capacitación laboral

Dos modelos exitosos:

- Ciudades con servicios consolidados (Pasto/Medellín)

- Ciudades con apuesta educativa (Montería/San Andrès)

- Foco crítico: Cúcuta/Cali requieren urgentes mejoras en cobertura sanitaria

- Dim5: Salud vs Violencia (H/MI)

- Dim6: Formación laboral + Vulnerabilidades

- Bogotá: Violencia + Capacitación

- Cúcuta/Cali: Urgen mejoras en salud

-  Pasto/Medellín: Modelo a replicar

---

### Biplots

#### Biplot en las Dimensiones 1 y 2

```{r biplotdim12, echo=FALSE, warning=FALSE, fig.cap="Figura 4. Biplot: Variables y ciudades en las Dimensiones 1 y 2", fig.align='center'}
print(
  fviz_pca_biplot(pcaRHINTce,
                  axes = c(1, 2),
                  geom = c("point", "text"),
                  col.ind = "cos2",
                  gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
                  col.var = "contrib",
                  alpha.var = "contrib",
                  repel = TRUE,
                  title = "Biplot ACP - Dimensiones 1 y 2",
                  legend.title = list(
                    cos2 = "Calidad de representación",
                    contrib = "Contribución (%)"
                  )) +
    theme_minimal() +
    theme(legend.position = "right")
)
```

---

##### Biplot Dimensiones 1 y 2
El biplot (41.5% varianza total) revela contrastes socioeconómicos entre ciudades:

- Dimensión 1 (25.5%): Seguridad vs. Desarrollo

  - (+) Riohacha/Valledupar: altos Homicidios (H) y Mortalidad Infantil (MI)

  - (-) Bogotá/Medellín: mejor Cobertura Salud (CS) y Educación Superior (CBES)

- Dimensión 2 (16%): Excelencia educativa

  - (+) Bogotá/Medellín: destacan en Calidad Colegios (CC) y CBES

  - (-) San Andrés/Ibagué: menores indicadores educativos

- Variables suplementarias (internacionalización) correlacionan levemente con ciudades desarrolladas.

---

#### Biplot en las Dimensiones 1 y 3

```{r biplotdim13, echo=FALSE, warning=FALSE, results='asis',fig.cap="Figura 4.1 biplot Dimensiones 1 y 3"}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(1, 3),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 1 y 3",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")
```

---

##### Biplot Dimensiones 1 y 3


\scriptsize
- Ejes principales (40.3% varianza total):

- Dimensión 1 (25.5%): Contrasta dinamismo demográfico (TCP, AA) con calidad educativa (CC, CBES). Ciudades como Villavicencio muestran alto crecimiento pero desafíos en alfabetización, mientras Bogotá y Pasto destacan por su infraestructura formativa.

- Dimensión 3 (14.8%): Revela una tensión entre violencia (VI, DCFS) y escolarización básica (CBPS), con ciudades como Bucaramanga combinando buena cobertura educativa con focos de violencia doméstica.

- Hallazgos clave:

  - Cuatro perfiles urbanos identificados: desde ciudades con crecimiento acelerado y violencia (Villavicencio) hasta aquellas con educación sólida y baja criminalidad (Bogotá).

  - Variables como Cobertura en Salud (CS) y Secuestros (S) requieren análisis en otras dimensiones para su plena interpretación.

  - Las variables suplementarias (ej: diversificación de mercados) matizan patrones, sugiriendo que factores económicos complementan estas dimensiones.

- Conclusión: Este plano destaca la necesidad de políticas que equilibren crecimiento poblacional, calidad educativa y seguridad, invitando a profundizar en dimensiones adicionales para un diagnóstico integral.

---

#### Biplot en las Dimensiones 3 y 4

```{r biplotdim34, echo=FALSE, warning=FALSE, results='asis',fig.cap="Figura 4. biplot Dimensiones 3 y 4"}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(3, 4),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 3 y 4",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")
```

---

##### Biplot Dimensiones 3 y 4



- Dimensión 3 (14.8%):

  - Enfoque: Violencia intrafamiliar (VI) y delitos sexuales (DCFS)

  - Ciudades críticas: Bucaramanga (alta incidencia)

  - Ciudades destacadas: Armenia, Cartago y Manizales (baja incidencia + buena cobertura educativa CBPS)

- Dimensión 4 (11.4%):

. Variables económicas: BCPIB y TCP con influencia moderada

- Caso atípico: Villavicencio (dinámicas no explicadas por estas dimensiones)

- Conclusiones:

  - Patrones claros de violencia de género vs. desempeño educativo

  - Oportunidad para políticas focalizadas en seguridad ciudadana y equidad educativa

  - Necesidad de análisis adicional para casos atípicos


---

#### Biplot en las Dimensiones 5 y 6

```{r biplotdim56, echo=FALSE, warning=FALSE, results='asis',fig.cap="Figura 4. biplot Dimensiones 5 y 6"}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(5, 6),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 5 y 6",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")
```

---

##### Biplot Dimensiones 5 y 6


- Dimensión 5 (9%):

  - Variable clave: Homicidios (H)

  - Ciudades críticas: Riohacha, Pereira, Cúcuta (alta violencia letal)

- Dimensión 6 (8.5%):

  - Variable moderada: Secuestros (S) (impacto negativo)

  - Ciudades estables: Bogotá, Ibagué, Cartago (posición neutra)

- Patrón destacado:

  - Ciudades con alta incidencia de homicidios se agrupan claramente
  - Variables de bienestar (CS, CC) tienen influencia secundaria

