---
title: "Lab ACP"
author: 
  - Edwin Sanchez
  - Stephanie Tamayo
  - Andres Felipe Torres
  - Fredy Urrea
  - Sergio Velasquez
  - Manuel Espitia
date: "2025-05-18"
output: 
  beamer_presentation:
    theme: "Madrid"
    colortheme: "dolphin"
    fonttheme: "structurebold"
    keep_tex: true
    latex_engine: xelatex
    slide_level: 2
---


```{r setup, include=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduccion

Carga de achivos, organizacion de los datos y renombrar variables

```{r cars, results='hide',message = FALSE, warning=FALSE, }
setwd("C:/Users/pipet/Downloads")
getwd()
library("FactoMineR")
library("dplyr")
library("kableExtra")

CIUDADES <- readxl::read_excel("ciudades original-filtrado-con etiquetas (1).xlsx",
                               sheet = 1)
RHINT <- CIUDADES[,c("CIUDADES","RH_1","RH_2","RH_5","RH_6","RH_7","RH_8","RH_9",
                     "RH_10","RH_11","RH_12","RH_13","RH_14","RH_15","RH_16","INT_66",
                     "INT_67",
                     "INT_68","INT_69","INT_70")]
#RHINT
colnames(RHINT)[2:20] <- c("PC", "TCP","AA","CBPS","CBES","RAP","CC","CPT","CS","MI","DCFS"
                           ,"VI","H","S","BCPIB","CI","TOE","DP","DM")

```

## Punto 3.

Utilizar la funcion PCA del paquete FactoMiner para realizar un ACP de las variables de recursos humanos (RH) utilizando como ilustrativas las que le correspondieron al grupo


### Carga de archivos  y ejecucion del ACP

```{r pressure, results='hide', warning=FALSE, message=FALSE}

# Estandrizacion y asiganacion de nombres de la filas

RHINTce <- scale(RHINT[,2:20], scale = TRUE, center = TRUE)
colnames(RHINTce) <- colnames(RHINT)[2:20]

rownames(RHINTce) <- RHINT$CIUDADES

require(FactoMineR)

#ACP sin grafica
pcaRHINTce <- PCA(RHINTce, quanti.sup = c(15:19), graph = F, ncp = 6)

pcaRHINTce

```
### Valores propios y varianza explicada

```{r valvar, echo=FALSE, warning=FALSE, results='asis'}
# Tabla de valores propios y varianzas
vp <- round(pcaRHINTce$eig, 4)

# Crear tabla con kableExtra
require(kableExtra)
kable(vp, format = "latex", booktabs = TRUE,
      caption = "Valores propios, porcentaje de varianza y varianza acumulada", 
      label = "vprankis",
      col.names = c("Valor propio", "% Varianza", "% Acumulado")) %>%
  kable_styling(latex_options = c("scale_down", "hold_position")) %>%
  row_spec(0, bold = TRUE)  # Encabezados en negrita
```


**Análisis de los valores propios y varianza explicada:**   

Los resultados del ACP revelan que los primeros seis componentes presentan valores propios mayores a 1, explicando en conjunto el 85.25% de la varianza total. El primer componente principal captura el 25.51% de la variabilidad, mostrando la mayor influencia individual, mientras que los dos primeros componentes acumulan el 41.50%, lo que permite una representación bidimensional inicial aunque limitada. La inclusión progresiva de componentes hasta el sexto (85.25%) ofrece un equilibrio óptimo entre reducción dimensional y conservación de información. Sin embargo, alcanzar el 90% de varianza requeriría ocho componentes, indicando que la estructura subyacente de los datos está distribuida multidimensionalmente. Las cinco variables suplementarias, aunque no contribuyen al cálculo de la varianza, permitirán enriquecer la interpretación de estos componentes al analizar su proyección en el espacio factorial. Este comportamiento sugiere que, si bien es posible reducir significativamente la dimensionalidad, la complejidad de los datos exige considerar múltiples dimensiones para un análisis exhaustivo.
   
   
  

### Correlaciones variable factor

```{r correlaciones variable factor, echo=FALSE, warning=FALSE, results='asis', fig.width=2, fig.height=2, fig.pos='H', out.width='70%'}
#tabla latex correlaciones variable factor

kable(
  round(pcaRHINTce$var$cor[, 1:6], 4),  # Selección de 6 dimensiones
  "latex",
  booktabs = TRUE,
  caption = "Correlaciones variables-factor (primeras 6 dimensiones)",
  label = "cor_var_fact"
) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

**Análisis de correlaciones variables-factor en las primeras seis dimensiones:**

El análisis de las correlaciones revela patrones significativos en la estructura de los datos. En la Dimensión 1, la Tasa de Ocupación (0.904) y Tasa de Crecimiento Poblacional (0.819) muestran las correlaciones más altas, sugiriendo que este eje representa principalmente dinamismo económico y laboral. Contrariamente, la *Calidad de los Colegios (-0.671)* y *Cobertura en Educación Superior (-0.516)* presentan correlaciones negativas, indicando una posible tensión entre desarrollo urbano y calidad educativa. La Dimensión 2 está dominada por variables educativas (Cobertura Bruta en Educación Superior: 0.718) y demográficas (Población: 0.709), mientras que los *Secuestros (-0.632)* aparecen como contrapeso, reflejando un eje de "desarrollo vs. inseguridad". En la Dimensión 3, los Delitos contra la Formación Sexual (0.768) y Violencia Intrafamiliar (0.801) emergen como factores críticos, independientes de las dimensiones económicas. Las dimensiones restantes capturan relaciones más específicas: la Dimensión 4 asocia Secuestros (0.536) con variables educativas, la Dimensión 5 vincula Mortalidad Infantil (0.620) con Homicidios (0.688), y la Dimensión 6 muestra una fuerte correlación negativa entre *Cobertura en Salud (-0.759)* y otros factores.

### Variables y objetos graficados en distintas dimensione

###grafvarobjdim12

```{r gravardim12, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
library(factoextra)
library(gridExtra)

# Gráfico de variables (mejorando color y tamaño sin usar ggplot directamente)
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  label = "var",
  col.var = "cos2",          # Colorear por calidad de representación
  gradient.cols = c("blue", "orange", "red"), 
  repel = TRUE,              # Evita solapamientos
  title = "A) Variables",
  labelsize = 3
)

# Gráfico de individuos (universidades)
bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  label = "ind",
  col.ind = "cos2",          # Colorear por calidad de representación
  gradient.cols = c("blue", "orange", "red"), 
  repel = TRUE,              # Evita solapamientos
  title = "B) Ciudades (Individuos)",
  labelsize = 3
)

# Mostrar ambos gráficos lado a lado
grid.arrange(bipl1, bipl2, nrow = 1)


```
En la grafica se presentan los resultados del Análisis de Componentes Principales (PCA), donde se grafican las variables originales (izquierda) y las ciudades objeto de estudio (derecha) proyectadas sobre los dos primeros componentes principales (Dim.1 y Dim.2), que en conjunto explican el 41.5% de la varianza total de los datos (25.5% y 16% respectivamente).

El gráfico de variables muestra vectores que representan la correlación de cada variable con los dos primeros componentes. Las variables como Tasa de Crecimiento de la Población (TCP), Tasa de Ocupación (AA), Relación Alumno-Profesor (RAP), y Cobertura Bruta en Primaria y Secundaria (CBPS) presentan una fuerte contribución al primer componente (Dim.1), sugiriendo que este eje está relacionado con factores de desarrollo educativo y económico.

En cambio, variables como Capacitación para el trabajo (CPT) y Calidad de los colegios (CC) aparecen en sentido opuesto, lo que podría indicar que están asociadas a contextos menos desarrollados o con un perfil distinto.

Es importante destacar que variables como Violencia Intrafamiliar (VI), Homicidios (H) y Secuestros (S) presentan una baja calidad de representación en este plano (vectores cortos y colores azulados), lo cual sugiere que no están bien explicadas por estas dos primeras dimensiones. Por lo tanto, se recomienda considerar dimensiones adicionales (como la tercera o cuarta) si se desea analizarlas con mayor profundidad.

El gráfico de individuos. Ciudades como Bogotá, Medellín, Bucaramanga y Cali se encuentran proyectadas hacia el lado derecho del plano, asociadas con altas tasas de crecimiento, ocupación y coberturas educativas. En contraste, otras como San Andrés, Popayán, Ibagué o Villavicencio se sitúan en zonas opuestas, posiblemente reflejando un desempeño más bajo en esos indicadores.

El color de cada punto indica el grado de calidad de representación (cos2), donde valores cercanos a 1 (rojo intenso) implican una buena representación en el plano Dim.1–Dim.2, mientras que valores bajos (violeta o azul) advierten que la posición de esas ciudades debe interpretarse con cautela.

El plano factorial revela una estructura clara de oposición entre ciudades con altos niveles de desarrollo y cobertura educativa frente a otras con menor desempeño relativo. Además, permite identificar perfiles similares entre grupos de ciudades, útiles para análisis comparativos o formulación de políticas diferenciadas. 


## grafvarobjdim34
```{r grafvarobjdim34, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
# Cargar librerías
library(factoextra)
library(gridExtra)

# Gráfico de variables (dimensiones 3 y 4)
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  axes = c(3, 4),             # <<< Aquí el cambio principal
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables (Dim.3 vs Dim.4)",
  labelsize = 3
)

# Gráfico de individuos (dimensiones 3 y 4)
bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  axes = c(3, 4),             # <<< Aquí también
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos - Dim.3 vs Dim.4)",
  labelsize = 3
)

# Mostrar ambos gráficos lado a lado
grid.arrange(bipl1, bipl2, nrow = 1)

```
Análisis del gráfico de Dimensiones 3 y 4 del ACP

El gráfico presenta la distribución de variables y ciudades en las Dimensiones 3 (14.8% de varianza) y 4 (11.4%), que en conjunto explican el 26.2% de la variabilidad total. En el eje horizontal (Dimensión 3), dominado por delitos contra la formación sexual (DCFS) con una fuerte correlación positiva (0.7679), se observa un marcado contraste entre ciudades con altos índices de este tipo de violencia sexual frente a otras con menores registros. El eje vertical (Dimensión 4) muestra una relación inversa entre secuestros (S) y cobertura educativa básica (CBPS), evidenciando que las zonas con mayor incidencia de secuestros tienden a presentar menores niveles de acceso a educación primaria y secundaria.

Las variables clave se agrupan en patrones claros: los delitos sexuales (DCFS) y la violencia intrafamiliar (VI) aparecen estrechamente asociados en el cuadrante positivo de la Dimensión 3, mientras que los secuestros (S) se ubican en el extremo positivo de la Dimensión 4.

###grafvarobjdim56


```{r grafvarobjdim56, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
# Cargar librerías
library(factoextra)
library(gridExtra)

# Gráfico de variables (dimensiones 3 y 4)
bipl1 <- fviz_pca_var(
  pcaRHINTce,
  axes = c(5, 6),             # <<< Aquí el cambio principal
  label = "var",
  col.var = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "A) Variables (Dim.5 vs Dim.6)",
  labelsize = 3
)

# Gráfico de individuos (dimensiones 3 y 4)
bipl2 <- fviz_pca_ind(
  pcaRHINTce,
  axes = c(5, 6),             # <<< Aquí también
  label = "ind",
  col.ind = "cos2",
  gradient.cols = c("blue", "orange", "red"),
  repel = TRUE,
  title = "B) Ciudades (Individuos - Dim.5 vs Dim.6)",
  labelsize = 3
)

# Mostrar ambos gráficos lado a lado
grid.arrange(bipl1, bipl2, nrow = 1)

```
**Análisis del gráfico:**  

El gráfico muestra la relación entre las variables y las ciudades en las Dimensiones 5 y 6 del ACP, que en conjunto explican el 17.5% de la varianza total. En el eje horizontal (Dimensión 5, 9%), asociado a **homicidios y mortalidad infantil**, se observa que ciudades como **Cali, Bogotá y Cúcuta** presentan los valores más altos, lo que indica graves problemas de violencia y salud pública. Por el contrario, **Armenia, Pereira e Ibagué** se ubican en la zona izquierda, reflejando mejores condiciones en estos indicadores.  

En el eje vertical (Dimensión 6, 8.5%), vinculado a **cobertura en salud y tamaño poblacional**, las ciudades más grandes (**Bogotá, Cali**) aparecen en la parte superior, confirmando que su expansión demográfica está asociada a una menor accesibilidad a servicios médicos. Ciudades como **Ríohacha y Villavicencio** también muestran deficiencias en cobertura sanitaria, a pesar de no tener los niveles de violencia de las metrópolis. Mientras tanto, **Pasto y Armenia** destacan por su mejor desempeño en este aspecto.  

Los vectores de las variables refuerzan estas tendencias: **homicidios (H)** y **mortalidad infantil (MI)** apuntan hacia las ciudades de alto riesgo, mientras que **cobertura en salud (CS)** se dirige en sentido opuesto al tamaño poblacional (PC), evidenciando la tensión entre urbanización y acceso a servicios básicos. Este gráfico subraya la necesidad de políticas diferenciadas: **intervenciones urgentes en seguridad y salud para las grandes ciudades**, y **replicación de modelos exitosos de ciudades intermedias** como Armenia, donde estos problemas están mejor controlados.

### Biplots
### biplotdim12

```{r biplotdim12, echo=FALSE, warning=FALSE, results='asis'}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(1, 2),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 1 y 2",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")

```

### biplotdim34

```{r biplotdim34, echo=FALSE, warning=FALSE, results='asis'}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(3, 4),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 3 y 4",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")
```

### biplotdim56

```{r biplotdim56, echo=FALSE, warning=FALSE, results='asis'}
#biplot
#reprenstacion simulatane de universidades y variables

fviz_pca_biplot(pcaRHINTce,
                axes = c(5, 6),  # Ejes a visualizar (primera y segunda dimensión)
                geom = c("point", "text"),  # Mostrar puntos y etiquetas
                col.ind = "cos2",  # Color de individuos por calidad de representación
                gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),  # Escala de colores
                col.var = "contrib",  # Color de variables por contribución
                alpha.var = "contrib",  # Transparencia según contribución
                repel = TRUE,  # Evitar solapamiento de etiquetas
                title = "Biplot ACP - Dimensiones 5 y 6",
                legend.title = list(
                  cos2 = "Calidad de representación",
                  contrib = "Contribución (%)"
                )) +
  theme_minimal() +
  theme(legend.position = "right")
```


### Cosenos cuadrados de los objetos con los factores
### cos212

```{r cos212, , echo=FALSE, warning=FALSE, results='asis'}
# Crear un dataframe con todas las métricas
var_coord <- as.data.frame(round(pcaRHINTce$var$coord, 4))
var_contrib <- as.data.frame(round(pcaRHINTce$var$contrib, 2))
var_cos2 <- as.data.frame(round(pcaRHINTce$var$cos2, 4))

# Combinar solo las primeras 2 dimensiones
var_results <- data.frame(
  Variable = rownames(var_coord),
  Coord_Dim1 = var_coord[,1],
  Coord_Dim2 = var_coord[,2],
  Contrib_Dim1 = var_contrib[,1],
  Contrib_Dim2 = var_contrib[,2],
  Cos2_Dim1 = var_cos2[,1],
  Cos2_Dim2 = var_cos2[,2]
)

# Crear la tabla
knitr::kable(var_results, "latex", booktabs = TRUE, 
             caption = "Resultados del PCA: Coordenadas, Contribución y Calidad de Representación",
             label = "pca_results") %>%
  kableExtra::kable_styling(latex_options = c("striped", "scale_down", "hold_position"))

```


### cos234
```{r cos234, , echo=FALSE, warning=FALSE, results='asis'}
# Crear un dataframe con todas las métricas
var_coord <- as.data.frame(round(pcaRHINTce$var$coord, 4))
var_contrib <- as.data.frame(round(pcaRHINTce$var$contrib, 2))
var_cos2 <- as.data.frame(round(pcaRHINTce$var$cos2, 4))

# Combinar solo las primeras 2 dimensiones
var_results <- data.frame(
  Variable = rownames(var_coord),
  Coord_Dim3 = var_coord[,3],
  Coord_Dim4 = var_coord[,4],
  Contrib_Dim3 = var_contrib[,3],
  Contrib_Dim4 = var_contrib[,4],
  Cos2_Dim3 = var_cos2[,3],
  Cos2_Dim4 = var_cos2[,4]
)

# Crear la tabla
knitr::kable(var_results, "latex", booktabs = TRUE, 
             caption = "Resultados del PCA: Coordenadas, Contribución y Calidad de Representación",
             label = "pca_results") %>%
  kableExtra::kable_styling(latex_options = c("striped", "scale_down", "hold_position"))

```

### cos256

```{r cos256, , echo=FALSE, warning=FALSE, results='asis'}
# Crear un dataframe con todas las métricas
var_coord <- as.data.frame(round(pcaRHINTce$var$coord, 4))
var_contrib <- as.data.frame(round(pcaRHINTce$var$contrib, 2))
var_cos2 <- as.data.frame(round(pcaRHINTce$var$cos2, 4))

# Combinar solo las primeras 2 dimensiones
var_results <- data.frame(
  Variable = rownames(var_coord),
  Coord_Dim5 = var_coord[,5],
  Coord_Dim6 = var_coord[,6],
  Contrib_Dim5 = var_contrib[,5],
  Contrib_Dim6 = var_contrib[,6],
  Cos2_Dim5 = var_cos2[,5],
  Cos2_Dim6 = var_cos2[,6]
)

# Crear la tabla
knitr::kable(var_results, "latex", booktabs = TRUE, 
             caption = "Resultados del PCA: Coordenadas, Contribución y Calidad de Representación",
             label = "pca_results") %>%
  kableExtra::kable_styling(latex_options = c("striped", "scale_down", "hold_position"))

```

